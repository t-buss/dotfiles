#!/usr/bin/env bash
set -e
set -o pipefail

function log() {
	local CONTENT
	CONTENT=$1
	DAILY_NOTE_FILENAME=`date +"%Y_%m_%d"`.md

	if [[ ! -f $HOME/Repos/obsidian/Reboot/DailyNotes/$DAILY_NOTE_FILENAME ]]; then
		cp $HOME/Repos/obsidian/Reboot/Templates/DailyNote.md \
			$HOME/Repos/obsidian/Reboot/DailyNotes/$DAILY_NOTE_FILENAME
	fi

	printf -- "- %b %b\n" "$TIMESTAMP" "$CONTENT" >> $HOME/Repos/obsidian/Reboot/DailyNotes/$DAILY_NOTE_FILENAME

	if [[ "${CONTENT,,}" =~ ^(lunch break) ]]; then
		printf -- "---\n" >> $HOME/Repos/obsidian/Reboot/DailyNotes/$DAILY_NOTE_FILENAME
	fi

}

TIMESTAMP=`date +%H:%M`
CONTENT=`echo -e "Good Morning\nDaily\nLunch Break\nBack from lunch\nFeierabend" | rofi -dmenu -l 5 -p ">>>"`

if [[ -z "$CONTENT" ]]; then
	exit 1
fi

if [[ "$CONTENT" =~ ^(todo|TODO) ]]; then
	CONTENT=$(echo $CONTENT | sed 's/^todo //gi')
	LINE=$(printf -- '- [ ] %b\n' "$CONTENT")
	sed -ibak --follow-symlinks "/^## Todo/a $LINE" $HOME/Repos/obsidian/Reboot/Projects/current.md
	rm $HOME/Repos/obsidian/Reboot/Projects/*.mdbak
	log "Created Todo: $CONTENT"
	exit 0
fi

if [[ "$CONTENT" =~ ^(doing ) ]]; then
	CONTENT=$(echo $CONTENT | sed 's/^doing //gi')
	LINE=$(printf -- '- [ ] %b\n' "$CONTENT")
	sed -ibak --follow-symlinks "/^## Doing/a $LINE" $HOME/Repos/obsidian/Reboot/Projects/current.md
	rm $HOME/Repos/obsidian/Reboot/Projects/*.mdbak
	log "Created Doing: $CONTENT"
	exit 0
fi

if [[ "$CONTENT" =~ ^(waiting ) ]]; then
	CONTENT=$(echo $CONTENT | sed 's/^waiting //gi')
	LINE=$(printf -- '- [ ] %b\n' "$CONTENT")
	sed -ibak --follow-symlinks "/^## Waiting/a $LINE" $HOME/Repos/obsidian/Reboot/Projects/current.md
	rm $HOME/Repos/obsidian/Reboot/Projects/*.mdbak
	log "Created Waiting: $CONTENT"
	exit 0
fi

if [[ "$CONTENT" =~ ^(done ) ]]; then
	CONTENT=$(echo $CONTENT | sed 's/^done //gi')
	LINE=$(printf -- '- [ ] %b\n' "$CONTENT")
	sed -ibak --follow-symlinks "/^## Done/a $LINE" $HOME/Repos/obsidian/Reboot/Projects/current.md
	rm $HOME/Repos/obsidian/Reboot/Projects/*.mdbak
	log "Created Done: $CONTENT"
	exit 0
fi

if [[ "$CONTENT" =~ ^(z ) ]]; then
	CONTENT=$(echo $CONTENT | sed 's/^z //gi')
	cp $HOME/Repos/obsidian/Reboot/Templates/ZettelkastenTemplate.md $HOME/Repos/obsidian/Reboot/Zettelkasten/"$CONTENT".md
	sed -ibak "s/^# $/# $CONTENT/g" $HOME/Repos/obsidian/Reboot/Zettelkasten/"$CONTENT".md
	rm $HOME/Repos/obsidian/Reboot/Zettelkasten/*.mdbak
	log "Created ZK note: [[$CONTENT]]"
	exit 0
fi

log "$CONTENT"

